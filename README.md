### 1. 상품
- 가격
- 수량

### 2. 프로모션

- 이름
- 구매량
- 리턴량
- 프로모션 시작 시간
- 프로모션 종료 시간

---

# 어플리케이션 흐름

1. 프로모션이 초기화 된다
2. 프로모션 정보를 바탕으로 프로덕트가 초기화 된다.
3. 사용자 장바구니가 초기화된다.
4. 물품을 구매한다.
- 물품 리스트가 주어지면, 물품 리스트에서 프로모션 할인을 적용한다. 이게 좀 문제.




4. 물품을 구매하면 프로덕트는 제거되고, 장바구니는 물품목록 및 가격으로 가득찬다.
5. 장바구니는 영수증으로 변환(포맷팅) 될 수 있다.

...

## 레포지토리 동작정리

1. md 데이터를 초기화하여 저장한다.
2. 저장된 데이터를 반환한다.
- 데이터는 프로모션이 있느냐에 따라 먼저 반환한다.
  - 프로모션이 있지만 수량이 부족한 경우 일반 품목을 반환한다.
3. 거래가 이루어지면(트랜잭션이 커밋되면) 수량을 차감하고, 아니라면 수량을 차감하지 않는다.
4. 수정은 이루어지지 않는다.

따라서 먼저 초기화 저장
데이터 반환
수량 차감

부터 구현한다. 이후 트랜잭션을 고려한다.


---

### 멤버십 동작정리

- 멤버십 회원은 프로모션이 아닌 상품 총합의 30%를 할인받는다.
- 프로모션 적용 후 남은 금액에 대해 멤버십 할인을 적용한다.
- 멤버십 할인의 최대 한도는 8,000원이다. 이 한도는 어플리케이션이 종료 될 때까지 유지한다.

## 영수증 동작정리

사움명, 수량, 금액 필드를 가진다.
"증정" 에 대한 처리를 한다. 증정은 promotion 을 판별하여 진행한다.
"행사할인" 은 promotion 의 총액
"멤버십 할인"은 총액에서 -한다.

### 주문 동작정리

1. 상품 품목, 수량이 입력된다
2. 품목 중 프로모션 할인을 먼저 적용한다.
- 프로모션 할인은 수량 % (buy + get) 해서, buy 만큼이 남으면 추가 증정
  - ex : 탄산 2+1 콜라를 8개 산다 -> 8 % (2 + 1) == 2(buy) 따라서 1 개 추가 증정 문구가 떠야한다. (이 논리는 괜찮은 것 같아)


### 프로모션 동작정리

- 프로모션 할인은 수량 % (buy + get) 해서, buy 만큼이 남으면 추가 증정
  - ex : 탄산 2+1 콜라를 8개 산다 -> 8 % (2 + 1) == 2(buy) 따라서 1 개 추가 증정 문구가 떠야한다. (이 논리는 괜찮은 것 같아)
- 프로모션 상품 재고는 어떻게 관리할꼬?


### 상품 동작정리


---

case 1. 프로모션 프로덕트를 둔다
- 프로모션 프로덕트 스스로 재고를 줄이고 더 필요한 수량을 리턴한다.
- 일반 프로덕트는 재고가 없을 시 예외를 발생시킨다. 롤백은 어찌할꼬?




# 추가사항

프로모션 여러개가 붙어있는 상품이 있다면?


---

1. 재고목록 뽑기
- 프로모션 있는 거, 없는 거 전부 다 뽑아야 한다.
- 따라서 여기에서는 상품/프로모션 나누지 않고 하나의 상품 데이터가 필요하다.

2. 영수증 뽑기
- 구매 품목들의 수량, 금액을 뺀다
- 프로모션 할인이 몇 개 되었는지 확인해야 한다. 즉 프로모션의 get 횟수 * 금액 == 할인내역이다.

여기가 문제. 어떻게 해야할까?



3. 멤버십 할인 적용하기 (구현완료)
- 멤버십 할인은 "프로모션 없는" 상품의 총합에서 30%를 제한다.

